### 컴퓨터시스템관리 / 20171802 심다원

###  **Server(b)에 RAID 구축**  ###    
  #### RAID 5 설치 ####      
    - 선택한 이유 : RAID1 은 데이터 안전성 측면에서 좋지만 같으 데이터를 복사해놔야 하기 때문에 공간 효율성이 떨어지고       
                 RAID0 의 공간 효율성은 뛰어나지만 데이터 복구를 할수 없다는 점이 있는데      
                 RAID5는 RAID1 과 RAID0 의 장점을 합친 RAID 여서 선택했다.    
                 RAID5는 하드디스크 오류시 짝수 패리티를 이용하여 오류난 데이터의 예측이 가능해서 데이터 복구가 가능하다.    
       
    
  <img src="https://user-images.githubusercontent.com/79961001/113046877-8fb80800-91db-11eb-9133-e3cf44702680.png"></img><br/>     
  <img src="https://user-images.githubusercontent.com/79961001/113046964-abbba980-91db-11eb-87e1-c45f65a81cce.png"></img><br/>      
      
     
---   

## 210330. 5주차 실습 일지


### **새로 배운 내용**
  
  #### 디스크 관리 -여러개의 하드디스크를 하나처럼 사용하기 ####  
  
  + RAID 6      
    + 1개의 패리티 정보를 사용하는 RAID 5 개선 (RAID 6 는 2개의 패리티 정보 사용)       
    + 최소 4개 이상의 하드디스크 필요 (실제로는 7~8개 이상의 하드디스크를 사용해야 정상적 사용이 가능함)      
    + RAID 5 보다 공간 효율은 낮지만, 데이터 신뢰도는 높아짐 : 신뢰도가 높아지면 공간효율과 속도는 떨어진다.     
    + 공간 사용 : 하드디스크의 개수 -2 (2개는 패리티 정보로 사용)   


  + RAID 1+0
    + RAID 1으로 구성한 디스크를 다시 RAID 0 으로 구성
    + 데이터의 신뢰성과 성능을 동시에 확보     
    + 공간효율도는 50%      
 
  + RAID 1+6
    + RAID 1으로 구성한 디스크를 다시 RAID 6으로 구성            
    + 아주 중요한 데이터를 다루는 경우 사용        
      
  + RAID 1+0
  + 쿼터 : 사용자별 용량 설정, 각사용자가 사용할 수 있는 파일의 용량 개수 제한. 새로운 하드디스크를 추가한 다음에 하드디스크를 마운트할때
  + 옵션으로 쿼터를 사용하겠다. 쿼터용 파일시스템을 사용하겟다 옵션 설정 해당 장치에 쿼터데이터 베이스를 생성하고 개인별로 계정별로 쿼터를 설정해서 
  + 실제로 설정이 어떻게 되는지 살펴봤음.      
  + fdisk -l  : 현재 장치를 보여주고 20GB(기존-파티션 나눠져 있음) /1GB(내가 추가한-파티션 아직 X ) 확인할 수 있음      
  + 추가한 디스크의 위치 확인하기 ( /dev/sdb )        
  + 파티션 할당 - fdisk /dev/sdb -> 파티션 만들기 - n  ->  파티션 타입 - p (primary)         
    -> 파티션넘버, 시작 섹터 위치, 마지막 섹터 위치 - enter(default)  ->  파티션이 하나 나눠짐 -> 저장하기 - W     
  + 리눅스가 접근할 수 있도록 파일 시스템을 생성해주기 =포맷 - mkfs -t ext4 /dev/sdb1     
  + 장치에 접근하기 위한 (=마운트) 작업 - 마운트 포인트 지정하기( mkdir /mydata ) -> 마운트 ( mount /dev/sdb1 /mydata/ )       
  + 부팅할때 하드디스크가 자동으로 마운트 되게 하는 작업 - nano /etc/fstab  -> /dev/sdb1 /mydata ext4 defaults 0 0 기입 -> reboot       
  
 
  #### LVM ####    
  
  + LVM (logical volume manage)
    + 논리적 볼륨을 효율적이고 유연하게 관리하기 위한 커널의 한 부분이자 프로그램
    + 하드디스크가 2개가 있을때 논리적으로 나눠서 3개로 쓸 수 있음
    + 용량 조절, 크기 조절, 편의에 따른 장치 이름 지정, 디스크 스트라이핑, 미러 볼륨 제공    
  + 전통적인 시스템에서는 File system을 사용해서 Block device(물리적인 디바이스)를 제어하게 됨      
  + LVM 기반 시스템 
    + PV (Physical Volume) : LVM에서 사용할 수 있는 블록 장치 전체 또는 블록 장치를 이루고 있는 파티션    
    + PE (Physical Extent) : PV를 구성하는 일정한 크기의 블록 (LVM2에서 기본 크기는 4MB로 매우 작고 일정한 크기로 이루어짐)    
    + VG (Volume Group) : PV들의 집합으로 LV를 할당할 수 있는 공간 (볼륨 그룹이 PV들을 모아 놓은 것)   
    + LV (Logical Volume) : 사용자가 다루게 되는 논리적인 저장 공간, Linear LV / Striped LV / Mirrored LV
    + LE (Logical Extent) : LV 를 구성하는 일정한 크기의 블록
    + +LE를 가지고 우리가 원하는대로 묶는데, 전체 4개로 파티션 되어 있는걸 3개로 나눔. LV1, LV2, LV3로 변환.     
        이 로지컬 볼륨이 하나의 파티션으로 파일시스템이 이해할 수 있게 됨.        
  
  
  #### 사용자 별 공간 할당 ####     
  
  + 사용자 별로 사용할 수 있는 용량을 제한하기.
  + 쿼터(Quota) : 파일 시스템마다 사용자나 그룹이 생성할 수 있는 파일의 용량 및 개수를 제한하는 것         
  + 사용자별 용량 설정, 각사용자가 사용할 수 있는 파일의 용량 개수 제한. 새로운 하드디스크를 추가한 다음에 하드디스크를 마운트할때     
    옵션으로 쿼터용 파일 시스템 설정 - 옵션 설정 해당 장치에 쿼터 데이터 베이스를 생성 - 개인별로 계정별로 쿼터를 설정              


  
  
  <img src="https://user-images.githubusercontent.com/79961001/113027870-8c198680-91c5-11eb-8157-e3a4c809bffa.png" width="450px" height="300px" title="px(픽셀) 크기 설정" alt="RubberDuck"></img><br/>    
   
  
  + RAID를 구성하기 위해서 필요한 프로그램이 mdadm ( apt update -> apt install mdadm )           
  + LinearRAID 만들기     
    raid 구성하기: mdadm --create /dev/md9 --level=linear --raid-devices=2 /dev/sdb1 /dev/sdc1       
    리눅스가 접근할 수 있도록 파일 시스템을 생성해주기 =포맷: mkfs -t ext4 /dev/md9    
    연결해주기위한 mount: mkdir /raidLinear  ->  mount /dev/md9 /raidLinear/       
    부팅할때 하드디스크가 자동으로 마운트 되게 하는 작업 - logout -> sudo gedit /etc/fstab -> /dev/md9 /raidLinear ext4 defaults 0 0 기입     
  + 그리고 다시 su - 로 root 계정으로 들어온 뒤 RAID0, RAID1, RAID5 도 동일한 방법으로 진행 후 reboot      
    이후에 mdadm 버그에 대한 추가 설정을 해줌.       
  
      
  <img src="https://user-images.githubusercontent.com/79961001/113034083-ab67e200-91cc-11eb-9e9f-e9d7b07595c6.png"></img><br/>       

     

 
  
  #### 하드디스크 교체 ####
  
  
  + vmware에서 4개의 장치를 추가     
  + LinearRAID, RAID0 복구 
    파티션 나누는거 부터 다시 시작.     
    파티션 할당 - fdisk /dev/sdb -> 파티션 만들기 - n  ->  파티션 타입 - p (primary)        
    ls /dev/sd* -> mdadm --stop /dev/md9  -> mdadm --create /dev/md9 --level=linear --raid-devices=2 /dev/sdb1 /dev/sdc1             
    -> mdadm --detail /dev/md9               
  + 원래 작동이 되던 RAID1, RAID5는 mdadm /dev/md1 --add /dev/sdg1(혹은 sdi1) 과정을 거침
  + 마지막으로 부팅할때 하드디스크가 자동으로 마운트 되게 하는 작업 - nano /etc/fstab 에서 주석을 해제 -> nano를 이용하여 추가설정을 해서 버그를 해결.       
   
   
  + 복구 완료        
  <img src="https://user-images.githubusercontent.com/79961001/113043465-70b77700-91d7-11eb-990b-64080c53ba9a.png"></img><br/>       

    
    
### **문제가 발생하거나 고민한 내용 + 해결 방안**  

  
  + 쿼터 실습할때 파일를 복사해서 용량 제한 확인을 하려고 했는데 vmlinuz.old 파일이 접근이 안돼서   
  + 읽기가 허가된 파일을 찾아서 cp /boot/memtest86+.bin test1 을 통해서 파일을 복사해올 수 있었다.
    <img src="https://user-images.githubusercontent.com/79961001/113747383-4b2fed80-9742-11eb-84b0-e4ca69898155.png"></img><br/>             



### **참고할만한 내용**      
  + LVM 그림과 개념 설명 참고     
  https://kit2013.tistory.com/199    
      
  
### **회고(좋았던 점, 아쉬웠던 점, 새로 알게된 점)**

**좋았던 점**   
```
하드디스크 관리와 오류가 생겼을때 데이터를 복구할 수 있는 방법들을 배우면서 조금더 컴퓨터를 잘다루게 된 기분이 들었다.     
파티션을 할당하고 포맷하고 마운트한다는 것이 굉장히 어려워 보였는데 몇번 반복해서 실습을 따라하다보니까 생각보다 어렵지 않았다.    
그리고 데이터가 복구된 순간이 가장 흥미로웠다.    
복구 방법과 과정을 실습하면서 깨진 데이터를 살린게 정말 인상깊었고 이 방법을 모르고 데이터를 잃어버렸을 생각을 하니 조금 아찔했다.
그리고 실습을 진행할때는 명령어와 실습 과정들이 이해가 됐어도 다음에 다시 할려고 하면 어렵고 헷갈릴 때가 많은데       
교수님 말씀대로 코딩실력이 뛰어난 사람들도 전부 명령어를 찾아보면서 코드를 짠다는것을 생각하며 힘을 받아서 앞으로의 수업에 임해야겠다고 생각했다.    
```
**아쉬웠던 점**      
```
강의들으면서 실습을 진행하다가 마운트 과정에서 스펠링 실수르 해서 그 후에 진행하다가 작동이 안되는것을 깨닫고          
다시 server 파일을 지우고 백업 파일을 받아와서 처음부터 다시 해야했다.     
스펠링 하나하나가 정말로 중요하다는 것을 다시한번 깨닫게 되었다.      
그래서 vi 버전이나 nano 에서 입력하는것도 실수할까봐 두려워서 그런 작업들을 거의 다 gedit 으로 진행했다.    
```

**새로 알게된 점**   
```
하드디스크 여러개를 하나처럼 사용하 수 있다는 것을 처음 알았고 그 방법이 7개의 레벨로 나뉜다는 것도 신기했다.       
그 하드디스크 중에 하나가 손상되어도 복구를 시키거나 장치를 교체해서 다시 실행되도록 하는 것을 실습해보면서 정말 흥미로웠고     
속도가 중요한지 데이터 안전성이 중요한지 그 목적성에 따라 다르게 하드디스크를 세팅해야 한다는 것도 새롭게 알게 되었다.      
```
